# 下屋付き建物（単純矩形・高さ段差あり）計算ロジック

## 1. 下屋付き建物とは

建物本体の一部に下屋（軒の出、庇、ポーチなど）が接続している形状。
平面図では矩形だが、断面図で高さの段差がある。

## 2. 下屋付き建物の表現例（南面に下屋）

### テキスト表現

```
Y方向（北）
  ↑
  |
(0,4510) +------------------+ (8400,4510)
         |      edge1       |
         |                  |
         |                  |
    edge4     本体部分    edge2
         |    (高層)        |
         |                  |
         |                  |
(0,910)  +==================+ (8400,910)  ← 本体と下屋の境界
         |      edge5       |
         |                  |
    edge4    下屋部分     edge2
         |    (低層)        |
         |                  |
         +------------------+
       (0,0)    edge3      (8400,0)

         X方向（東）→

建物寸法:
  全体幅: 8400mm
  全体奥行: 4510mm
    - 本体奥行（H1）: 3600mm (910-4510mm)
    - 下屋奥行（H2）: 910mm (0-910mm)
```

### 座標表現

頂点リスト（左下から時計回り）:
```
(0, 0) → (8400, 0) → (8400, 4510) → (0, 4510) → (0, 0)
```

**高さ境界**: Y = 910mm で本体と下屋の高さが変わる

### 辺の名称（左下から時計回り）

```
edge1: 北辺（本体） - (0,4510) → (8400,4510) - 8400mm
edge2: 東辺（全体） - (8400,4510) → (8400,0) - 4510mm
  - 上部: (8400,4510) → (8400,910) - 3600mm（本体高さ）
  - 下部: (8400,910) → (8400,0) - 910mm（下屋高さ）
edge3: 南辺（下屋） - (8400,0) → (0,0) - 8400mm
edge4: 西辺（全体） - (0,0) → (0,4510) - 4510mm
  - 下部: (0,0) → (0,910) - 910mm（下屋高さ）
  - 上部: (0,910) → (0,4510) - 3600mm（本体高さ）
edge5: 内部境界（本体南面） - (0,910) → (8400,910) - 8400mm
```

### 各面の構成

```
北面: edge1（本体の北側壁）
東面: edge2（本体 + 下屋の東側壁、高さ段差あり）
南面: edge3（下屋の南側壁）
西面: edge4（本体 + 下屋の西側壁、高さ段差あり）
内部面: edge5（本体南面、下屋との接続部）
```

### 断面図（東西方向から見た図）

```
           本体高さ
           ↓
        +-------+
        |       | ← 本体部分
        |       |
        +-------+ ← Y=910mm（高さ境界）
        |       | ← 下屋部分（低い）
地面 ---+-------+
        ↑       ↑
      Y=0     Y=4510
```

## 3. 下屋付き建物の計算方針

### 平面的な特徴

- 平面図では**単純な矩形**（8400mm × 4510mm）
- 特殊な角（入隅・出隅）は存在しない
- 通常の矩形計算が基本

### 立体的な特徴（高さの段差）

1. **本体部分（H1 = 3600mm）**
   - Y座標: 910mm ～ 4510mm
   - 建物高さ: 高層（例: 10m）
   - 足場高さ: 建物全高に対応

2. **下屋部分（H2 = 910mm）**
   - Y座標: 0mm ～ 910mm
   - 建物高さ: 低層（例: 3m）
   - 足場高さ: 下屋の高さまで

3. **接続部分（edge5）**
   - 本体南面と下屋の接続部
   - 高さ段差の処理が必要
   - 足場の連続性を確保

### 計算の基本方針

1. **平面的な足場総長さ**
   - 矩形として計算: 2 × (8400 + 4510) = 25820mm
   - 離隔距離を考慮して調整

2. **高さ別の足場面積**
   - 北面（edge1）: 8400mm × 本体高さ
   - 東面・西面（edge2, edge4）: 上部（本体）+ 下部（下屋）
   - 南面（edge3）: 8400mm × 下屋高さ
   - 内部面（edge5）: 必要に応じて設置

3. **段差部分の処理**
   - 東面・西面で高さが変わる位置（Y=910mm）
   - 足場のレベル調整が必要
   - 階段や斜路の設置を検討

## 4. 実装上の注意点

### 4.1 平面計算

平面的には通常の矩形なので、既存の矩形計算ロジックを使用可能。

### 4.2 高さ段差の処理

1. **下屋の高さが小さい場合**（H2 < 1000mm）
   - 専用足場が不要な場合がある
   - 本体の足場から作業可能か判断

2. **下屋の高さが大きい場合**（H2 > 1500mm）
   - 独立した足場層が必要
   - 本体との連結部を強化

3. **作業動線**
   - 本体から下屋への移動経路
   - 階段や斜路の配置

4. **屋根勾配**
   - 下屋の屋根勾配によって実際の高さが変わる
   - 最高点での足場高さを考慮

## 5. 実装予定

- [ ] 下屋付き建物の計算ロジック実装
- [ ] 高さ段差を考慮した足場面積計算
- [ ] 東西面の段差部分の処理アルゴリズム
- [ ] 下屋高さに応じた足場要否判定
- [ ] テストケースの作成と検証

## 6. 下屋上に入隅がある建物

### 6.1 建物形状

全体の外周は単純な矩形だが、下屋のライン（内部境界）にL字型の入隅がある形状。

### 6.2 テキスト表現

```
Y方向（北）
  ↑
  |
(0,10000) +------------------+ (8400,10000)
          |      edge1       |
          |                  |
          |                  |
     edge8     本体部分    edge2
          |    (高層)        |
          |                  |
          |        +---------+ (8400,8000)
          |        | edge9b  |
          |   edge10         |
          |        |         |
(0,7000)  +--------+ (3000,7000)  ← 入隅
          | edge9a |
     edge8   下屋部分       edge2
          |                  |
          |                  |
          +------------------+
        (0,0)    edge3      (8400,0)

         X方向（東）→

建物寸法:
  全体幅: 8400mm
  全体奥行: 10000mm
    - 本体部分: 左側のみ、Y座標8000-10000mm（高さ2000mm）
    - 下屋部分: 全幅、Y座標0-7000mm（高さ7000mm）
  入隅位置: (3000, 7000)
  入隅縦辺の長さ: 1000mm (7000-8000mm)
  edge9aの長さ: 3000mm
  edge9bの長さ: 5400mm
```

### 6.3 座標表現

頂点リスト（左下から時計回り）:
```
(0, 0) → (8400, 0) → (8400, 10000) → (0, 10000) → (0, 0)
```

**高さ境界（内部境界）**:
- Y = 7000mm: 下屋上端
- Y = 8000mm: 本体下端（左側のみ、入隅より右側）

### 6.4 辺の名称

```
外周辺:
  edge1: 北辺（本体） - (0,10000) → (8400,10000) - 8400mm
  edge2: 東辺（全体） - (8400,10000) → (8400,0) - 10000mm
  edge3: 南辺（下屋） - (8400,0) → (0,0) - 8400mm
  edge8: 西辺（全体） - (0,0) → (0,10000) - 10000mm

内部境界（下屋ライン、L字型）:
  edge9a: 左側横辺 - (0,7000) → (3000,7000) - 3000mm
  edge10: 入隅縦辺（上向き） - (3000,7000) → (3000,8000) - 1000mm
  edge9b: 右側横辺 - (3000,8000) → (8400,8000) - 5400mm

入隅位置: (3000, 7000) - edge9aとedge10の交点
```

### 6.5 計算方針

#### 基本的な考え方

1. **外周計算**: 全体は単純な矩形として計算
2. **内部境界の入隅計算**: edge10に入隅計算ロジックを適用
3. **edge9aとedge9bの計算**: 入隅計算の結果から逆算

#### 計算手順

**Step 1: 外周edgeの計算**
- X方向（edge1, edge3）: 通常の矩形計算
- Y方向（edge2, edge8）: 通常の矩形計算

**Step 2: 入隅縦辺（edge10）の離隔計算**
- 同じ面（西面）の外周辺edge8の離隔 + edge9aの建物長さ - 300の倍数
- 入隅計算ロジックを適用

**Step 3: 入隅横辺（edge9b）の離隔計算**
- 同じ面（下屋南面）のedge3の離隔 + edge10の建物長さ - 300の倍数
- 入隅計算ロジックを適用

**Step 4: edge9aの足場長さを逆算**
- X方向の足場総長さから、edge9bの足場長さを引く

### 6.6 実装上の注意点

1. **二重の入隅計算**
   - edge10（縦辺）の入隅計算
   - edge9b（横辺）の入隅計算
   - 順序: edge10 → edge9b → edge9a

2. **面の分類**
   - 外周面: 単純な矩形として処理
   - 内部境界面: L字型の入隅として処理

3. **高さの考慮**
   - 本体部分: Y座標8000mm以上（左側のみ、入隅より右側）
   - 下屋部分: Y座標0-7000mm（全幅）
   - 中間部分: Y座標7000-8000mm（左側のみ、入隅の縦辺）

## 7. 参考：他の形状との比較

| 項目 | 矩形建物 | 下屋付き建物 | 下屋上に入隅 | L字型 | コの字型 |
|------|---------|------------|------------|-------|---------|
| 平面形状 | 単純矩形 | 単純矩形 | 単純矩形 | 入隅1箇所 | 出隅2箇所 |
| 外周 | 矩形 | 矩形 | 矩形 | L字 | コの字 |
| 内部境界 | なし | 直線 | L字（入隅） | なし | なし |
| 高さ | 均一 | 段差あり | 段差あり | 均一 | 均一 |
| 特殊処理 | なし | 高さ段差 | 入隅計算 | 入隅計算 | 出隅計算 |
| 計算難易度 | 低 | 中 | 高 | 中 | 高 |
