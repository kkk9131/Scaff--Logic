# 階段形状（連続した入隅）計算ロジック

## 1. 階段形状とは

建物平面図を上から見たときに、段差が連続している形状のこと。
複数の入隅が連続して現れるため、入隅計算を順次適用する必要がある。

## 2. 階段状建物の表現例（3段・入隅2箇所）

### テキスト表現

```
Y方向（北）
  ↑
  |
(0,10000) +--------+ (3000,10000)
          |  edge1 |
          |        |
     edge8       edge2
          |        |
          |        +--------+ (6000,7000)
          |        |  edge3 |
          |        |        |
          |             edge4
          |        |        |
          |        |        +--------+ (9000,4000)
          |        |        |  edge5 |
          |        |        |        |
          |                     edge6
          |        |        |        |
          +--------+--------+--------+
        (0,0)    edge7              (9000,0)

         X方向（東）→

建物寸法:
  1段目（左上）: 幅3000mm × 奥行10000mm
  2段目（中央）: 幅3000mm × 奥行3000mm (7000-10000mm)
  3段目（右下）: 幅3000mm × 奥行4000mm (0-4000mm)
```

### 座標表現

頂点リスト（左上から時計回り）:
```
(0, 10000) → (3000, 10000) → (3000, 7000) → (6000, 7000)
→ (6000, 4000) → (9000, 4000) → (9000, 0) → (0, 0) → (0, 10000)
```

### 辺の名称（左上から時計回り）

```
edge1: 上辺 - (0,10000) → (3000,10000) - 3000mm
edge2: 1段目の縦辺（下向き）- (3000,10000) → (3000,7000) - 3000mm
edge3: 1段目の横辺（右向き）- (3000,7000) → (6000,7000) - 3000mm
edge4: 2段目の縦辺（下向き）- (6000,7000) → (6000,4000) - 3000mm
edge5: 2段目の横辺（右向き）- (6000,4000) → (9000,4000) - 3000mm
edge6: 右辺 - (9000,4000) → (9000,0) - 4000mm
edge7: 下辺 - (9000,0) → (0,0) - 9000mm
edge8: 左辺 - (0,0) → (0,10000) - 10000mm
```

**入隅部分**: 2箇所
- 入隅1: (3000, 7000) - edge2とedge3の交点
- 入隅2: (6000, 4000) - edge4とedge5の交点

### 各面の構成

```
上面（北）: edge1
右面（東）: edge2, edge3, edge4, edge5, edge6
下面（南）: edge7
左面（西）: edge8
```

## 3. 階段形状計算の基本方針

1. **外接矩形からの段階的削り取り**
   - まず全体の外接矩形（9000mm × 10000mm）で足場総長さを計算
   - 各段の入隅を順次計算して調整

2. **連続した入隅の処理順序**
   - 左から右へ（または上から下へ）、順番に入隅計算を適用
   - 前の入隅計算の結果を次の入隅計算の基準値として使用

3. **各辺の分類**
   - 外周辺: edge1（上）、edge6（右）、edge7（下）、edge8（左）
   - 入隅辺1: edge2（縦）、edge3（横）
   - 入隅辺2: edge4（縦）、edge5（横）

4. **離隔距離の一貫性**
   - 建物外周から足場までの距離は全周で目標値（900mm）に近づける
   - 入隅部分でも同じルールを適用

## 4. 計算手順

### Step 1: 外接矩形の足場総長さを計算

外接矩形: 9000mm × 10000mm
- X方向（東西）: 離隔距離と足場総長さを計算
- Y方向（南北）: 離隔距離と足場総長さを計算

### Step 2: 入隅1（edge2, edge3）の計算

- edge2の計算:
  - 同じ右面の外周辺edge6の離隔を基準
  - edge3の建物長さを加算
  - 300の倍数を引いて900mmに近づける

- edge3の計算:
  - 同じ段の横方向の基準辺を使用
  - edge2の建物長さを加算
  - 300の倍数を引いて900mmに近づける

### Step 3: 入隅2（edge4, edge5）の計算

- edge4の計算:
  - edge2の離隔距離を基準として使用
  - edge5の建物長さを加算
  - 300の倍数を引いて900mmに近づける

- edge5の計算:
  - edge3の離隔距離を基準として使用
  - edge4の建物長さを加算
  - 300の倍数を引いて900mmに近づける

### Step 4: 外周辺の足場長さを逆算

- 右面（東）の足場総長さから各辺の足場長さを計算
- 各辺の離隔距離と足場長さを確定

## 5. 実装予定

- [ ] 階段形状（連続入隅）の計算ロジック実装
- [ ] 3段以上の階段形状への対応
- [ ] 任意の段数・段差に対応する汎用ロジック
- [ ] テストケースの作成と検証
