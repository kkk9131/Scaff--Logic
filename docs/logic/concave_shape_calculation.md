# 凹型建物（コの字型）計算ロジック

## 1. 凹型建物とは

建物平面図を上から見たときに、上部が窪んでいる形状のこと。
コの字型とも呼ばれ、中庭や採光を確保するために使われる。
出隅（外角）が2箇所存在する。

## 2. 凹型建物の表現例（コの字型）

### テキスト表現

```
Y方向（北）
  ↑
  |
  (0,10000)+----+        +----+(10000,10000)
          |edge1|        |edge2|
          |    |        |    |
     edge8    |        |    edge3
          |    |        |    |
          |    +--------+    |
          |  (3000,8000) (7000,8000)
          |      edge4       |
          |      edge5       |
          +------------------+
        (0,0)    edge6     (10000,0)

         X方向（東）→

建物寸法:
  全体幅: 10000mm
  全体高さ: 10000mm（左右）、8000mm（中央凹み部分）
  凹み幅: 4000mm（3000-7000mm）
  凹み深さ: 2000mm（10000-8000mm）
```

### 座標表現

頂点リスト（左下から時計回り）:
```
(0, 0) → (10000, 0) → (10000, 10000) → (7000, 10000)
→ (7000, 8000) → (3000, 8000) → (3000, 10000) → (0, 10000) → (0, 0)
```

### 辺の名称（左下から時計回り）

```
edge1: 左上辺 - (0,10000) → (3000,10000) - 3000mm
edge2: 左側凹み部分の縦辺（下向き）- (3000,10000) → (3000,8000) - 2000mm
edge3: 凹み底辺 - (3000,8000) → (7000,8000) - 4000mm
edge4: 右側凹み部分の縦辺（上向き）- (7000,8000) → (7000,10000) - 2000mm
edge5: 右上辺 - (7000,10000) → (10000,10000) - 3000mm
edge6: 右辺 - (10000,10000) → (10000,0) - 10000mm
edge7: 下辺 - (10000,0) → (0,0) - 10000mm
edge8: 左辺 - (0,0) → (0,10000) - 10000mm
```

**出隅部分**: 2箇所
- 左側: (3000, 10000) - edge1とedge2の交点
- 右側: (7000, 10000) - edge4とedge5の交点

### 各面の構成

```
上面（北）: edge1, edge2, edge3, edge4, edge5
右面（東）: edge6
下面（南）: edge7
左面（西）: edge8
```

## 3. 凹型建物の計算方針

### 入隅と出隅の違い

- **入隅（内角）**: 建物が内側に凹んでいる角（L字型など）
  - 計算: 同じ面の外周辺の離隔 + 垂直方向の入隅辺の長さ - 300の倍数

- **出隅（外角）**: 建物が外側に突き出している角（凹型など）
  - 計算: 入隅とは逆のロジックが必要
  - 足場は建物の外側に配置されるため、別の処理が必要

### 計算の基本方針

1. **外接矩形からの考え方**
   - まず全体の外接矩形（10000mm × 10000mm）で足場総長さを計算
   - 凹み部分は足場が内側に入り込む

2. **出隅部分の処理**
   - 出隅では足場が建物を囲むように配置される
   - 入隅計算とは異なるロジックが必要

3. **各辺の分類**
   - 外周辺: edge1, edge5, edge6, edge7, edge8
   - 凹み部分: edge2（左側縦）, edge3（底辺）, edge4（右側縦）

## 4. 実装上の注意点

### 凹型建物の特徴

1. **足場の内側配置**
   - 凹み部分（edge2, edge3, edge4）には足場が内側に入り込む
   - 外周辺とは異なる離隔距離の計算が必要

2. **出隅の処理**
   - 出隅では足場同士が交差する
   - コーナー部分の処理が重要

3. **面の連続性**
   - 上面（北）は5つの辺で構成される不連続な面
   - 各辺の足場長さの合計が面の総長さと一致する必要がある

## 5. 実装予定

- [ ] 凹型建物（コの字型）の計算ロジック実装
- [ ] 出隅部分の処理アルゴリズム
- [ ] 凹み部分の足場配置最適化
- [ ] テストケースの作成と検証

## 6. 参考：入隅との比較

| 項目 | 入隅（内角） | 出隅（外角） |
|------|------------|------------|
| 形状 | 建物が内側に凹む | 建物が外側に突き出す |
| 例 | L字型、階段型 | コの字型 |
| 角度 | 270度 | 90度 |
| 足場配置 | 外側から囲む | 内側にも入り込む |
| 計算方法 | 実装済み | 要実装 |
